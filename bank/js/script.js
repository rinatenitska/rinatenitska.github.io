function user(){var t=new FormData(document.forms.login),e=new XMLHttpRequest;e.open("POST","/login",!0),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){if(null==sessionStorage.getItem("surl"))return window.location.href=e.responseURL,!0;var t=sessionStorage.getItem("surl");return sessionStorage.removeItem("surl"),window.location.href="account.html"+t,!0}},e.send(t)}function user_details(){$.ajax({type:"GET",url:"/user/details",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(t){$("#client_name").text(t.name+" "+t.surname),$("#client_email").text(t.email),$("#client_address").text(t.addres),$("#client_phone").text(t.phone)}})}function accounts(){$("#oper").remove(),$("#account_info").css("display","none"),$.ajax({type:"GET",url:"/accounts",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(e){for(var t=0;t<e.length;t++)$("<div class='wallet_item'></div>").appendTo("#wallet_id"),$(".wallet_item:last-child").text(e[t].id),$("<option></option>").appendTo("#account"),$("#account option:last-child").text(e[t].id);$(".wallet_item").on("click",function(){for(var t in $(".wallet_item").removeClass("active"),$(this).addClass("active"),$("#account_info").css("display","block"),$(".account_trans").attr("id",$(this).text()),$(".acc_adjunction").css("display","block"),$(".account_trans").css("display","block"),$("#oper").remove(),e){this===$(".wallet_item")[t]&&($("#acc_new_card").val($(this).text()),$("#wallet_num").text(e[t].id),$("#wallet_owner").text(e[t].user),$("#wallet_amount").text(e[t].amount),$("#wallet_currency").text(e[t].currency),$("#wallet_cards").html(e[t].cards.join("<br>")),$("<div class='buttons acc_add_card'>Замовити картку</div>").appendTo($("#wallet_cards")),$(".acc_add_card").on("click",function(){$(".acc_card_create").empty(),$("<form id='acc_card_create' name='acc_card_create'></form>").appendTo($(".acc_card_create")),$("<label for='acc_new_card'>Створити картку для рахунку: </label>").appendTo($("#acc_card_create")),$("<input id='acc_new_card' name='acc_new_card'>").appendTo($("#acc_card_create")),$("<input type='submit' value='Продовжити'>").appendTo($("#acc_card_create")),$("#acc_new_card").val($(".wallet_item.active").text()),$("#acc_card_create").on("submit",function(t){t.preventDefault();var e=new FormData(document.forms.acc_card_create),a=new XMLHttpRequest;a.open("POST","/accounts/add_card",!0),a.onreadystatechange=function(){if(4==a.readyState)return 200==a.status?window.location.href="card_info.html":window.location.href="error.html",!0},a.send(e)})}))}})}})}function accounts_transactions(){$("#account_adj").css("display","none"),$("#oper").remove();var t="/accounts/"+$(".account_trans").attr("id");$.ajax({type:"GET",url:t,dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(t){for(var e in $("<table id='oper'></table>").appendTo("#account_info"),t){var a,r,n,c=t[e].id,o=t[e].date,i=t[e].amount,d=t[e].description,s=t[e].status,l=t[e].currency,u=$(".wallet_item.active");n=$(u).text()===t[e].to?t[e].from:t[e].to,a="OK"===s?"img/confirm.png":"UNCONFIRMED"===s?"img/process.png":"img/cancel.png",r=t[e].to===t[e].from?"img/arrow_both.png":n==$(u).text()?"img/arrow_up.png":"img/arrow_down.png",$("<tr></tr>").prependTo("#oper"),$("#oper tr:first-child").html("<td class='trans_id'>"+c+"</td><td>"+o+"</td><td>"+d+"</td><td><img src='"+r+"'>"+i+" "+l+"</td><td><img src='"+a+"'></td>");for(var m=1;m<$("#oper tr").length;m++){var p=$("#oper tr")[m];c==+$(p).find(".trans_id").text()&&$(p).remove()}}},statusCode:{405:function(){return window.location.href="error.html",!0}}})}function account_adjunction(){var t=new FormData(document.forms.acc_adj),e=new XMLHttpRequest;e.open("POST","/account/adjunction",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?location.reload():window.location.href="error.html",!0},e.send(t)}function credit_adjunction(){var t=new FormData(document.forms.cred_adj),e=new XMLHttpRequest;e.open("POST","/account/adjunction",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?location.reload():window.location.href="error.html",!0},e.send(t)}function account_create(){var t=new FormData(document.forms.account_create),e=new XMLHttpRequest;e.open("POST","/accounts/create",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?location.reload():window.location.href="error.html",!0},e.send(t)}function credits(){$("#credit_oper").empty(),$("#credit_info").css("display","none"),$("#credit_adj").css("display","none"),$.ajax({type:"GET",url:"/credits",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(n){for(var t=0;t<n.length;t++)$("<div class='credit_item'></div>").appendTo("#credit_id"),$(".credit_item:last-child").text(n[t].id),$("<option></option>").appendTo("#account"),$("#account option:last-child").text(n[t].id);$(".credit_item").on("click",function(){for(var t in $(".credit_item").removeClass("active"),$(this).addClass("active"),$("#credit_info").css("display","block"),$(".credit_trans").attr("id",$(this).text()),$("#credit_oper").empty(),$("#credit_adj").css("display","none"),n){var e,a,r=$(".credit_item")[t];0<=parseFloat(n[t].amountLimit)-parseFloat(n[t].amount)?(e=parseFloat(n[t].amountLimit)-parseFloat(n[t].amount),a=0):(a=Math.abs(parseFloat(n[t].amountLimit)-parseFloat(n[t].amount)),e=0),this===r&&($("#credit_num").text(n[t].id),$("#credit_owner").text(n[t].user),$("#credit_limit").text(n[t].amountLimit.toFixed(2)),$("#credit_amount").text(e.toFixed(2)),$("#credit_money").text((Math.round(100*a)/100).toFixed(2)),$("#credit_durability").text(n[t].durability),$("#credit_month_pay").text((Math.round(100*n[t].mounthPay)/100).toFixed(2)),$("#credit_currency").text(n[t].currency),$("#credit_cards").html(n[t].cards.join("<br>")),$("<div class='buttons credit_add_card'>Замовити картку</div>").appendTo($("#credit_cards")))}$(".credit_add_card").on("click",function(){$("#credit_card_create").css("display","block"),$("#credit_new_card").val($(".credit_trans").attr("id"))})})}})}function credit_transactions(){var t="/credits/"+$(".credit_trans").attr("id");$.ajax({type:"GET",url:t,dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(t){for(var e in $("#credit_oper").remove(),$("#credit_adj").css("display","none"),$("<table id='credit_oper'></table>").appendTo("#credit_info"),t){var a,r,n,c=t[e].id,o=t[e].date,i=t[e].amount,d=t[e].description,s=t[e].status,l=t[e].currency,u=$(".credit_item.active");r=$(u).text()===t[e].to?t[e].from:t[e].to,n=t[e].to===t[e].from?"img/arrow_both.png":r==$(u).text()?"img/arrow_up.png":"img/arrow_down.png",a="OK"===s?"img/confirm.png":"UNCONFIRMED"===s?"img/process.png":"img/cancel.png",$("<tr></tr>").prependTo("#credit_oper"),$("#credit_oper tr:first-child").html("<td class='trans_id'>"+c+"</td><td>"+o+"</td><td>"+d+"</td><td><img src='"+n+"'>"+i+" "+l+"</td><td><img src='"+a+"'></td>");for(var m=1;m<$("#credit_oper tr").length;m++){var p=$("#credit_oper tr")[m];c==+$(p).find(".trans_id").text()&&$(p).remove()}}},statusCode:{405:function(){return window.location.href="error.html",!0}}})}function credit_offer(){var t=Number($("[name='credit_amount']").val());if(/\d{3}/.test(t)){var e=$("[name='credit_new_currency'] option:selected").text(),a=Number($("[name='credit_duration'] option:selected").text()),r=.15/12,n=(t*(r*Math.pow(1+r,a)/(Math.pow(1+r,a)-1))).toFixed(1),c=(n*a).toFixed(1);$("#credit_amount").val(t),$("#credit_currency").val(e),$("#credit_duration").val(a),$("#credit_coefficient").val(15),$("#credit_full_amount").val(c),$("#credit_per_month").val(n),$("#credit_item").css("display","block")}else alert("Введіть коректне значення суми")}function credit_create(){var t=new FormData(document.forms.credit_item),e=new XMLHttpRequest;e.open("POST","/credits/create",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="confirm_creation.html":window.location.href="error.html",!0},e.send(t)}function userUpdate(){var t=new FormData(document.forms.user_update),e=new XMLHttpRequest;e.open("POST","/user/update",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="account.html#profile":window.location.href="error.html",!0},e.send(t)}function transferCreate(){var t=new FormData(document.forms.transfer),e=new XMLHttpRequest;e.open("POST","/transfer/external",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="confirm_transaction.html":window.location.href="error.html",!0},e.send(t)}function transferConfirm(){var t=new FormData(document.forms.confirm_transfer),e=new XMLHttpRequest;e.open("POST","/confirm/transaction",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="account.html#profile":window.location.href="error.html",!0},e.send(t)}function creationConfirm(){var t=new FormData(document.forms.confirm_create),e=new XMLHttpRequest;e.open("POST","/confirm/creation",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="account.html#profile":window.location.href="error.html",!0},e.send(t)}function cards(){$.ajax({type:"GET",url:"/accounts",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(a){for(var t=0;t<a.length;t++)for(var e in $("<div class='wallet_item'></div>").appendTo("#wallet_card_num"),$(".wallet_item:last-child").text(a[t].id),a[t].cards)$("<option></option>").appendTo($("#card_number")),$("#card_number option:last-child").text(a[t].cards[e]);$(".wallet_item").on("click",function(){for(var t in $(".wallet_item").removeClass("active"),$(this).addClass("active"),$("#card_oper").remove(),$("#card_table_id").remove(),$("#card_adj").css("display","none"),a)if($(this).text()==a[t].id)for(var e in $("#card_item").empty(),a[t].cards)$("<div class='card-item'></div>").prependTo($("#card_item")),$("#card_item .card-item:first-child").html("<div class='card'><p class='card_num'>"+a[t].cards[e]+"</p></div><a href='card_pay.html' class='pay'><img src='img/card.png'><p>Перевести</p></a><div class='pay trans'><img src='img/transaction.png'><p>Виписка операцій</p></div><div class='pay adj'><img src='img/terminal.png'><p>Поповнити</p></div>");$("#card_item .card-item .card").on("click",function(){$(".card-item").removeClass("active"),$(this).parent().addClass("active"),$("#card_oper").remove(),$("#card_table_id").remove(),$("#card_adj").css("display","none")}),$(".pay.trans").on("click",function(){cards_transactions()}),$(".pay.adj").on("click",function(){$("#card_oper").remove(),$("#card_table_id").remove(),$("#card_adj").css("display","block"),$("#card_adj_num").val($(".card-item.active .card_num").text())})})}}),$.ajax({type:"GET",url:"/credits",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(a){for(var t=0;t<a.length;t++)for(var e in $("<div class='wallet_item'></div>").appendTo("#wallet_card_num"),$(".wallet_item:last-child").text(a[t].id),a[t].cards)$("<option></option>").appendTo($("#card_number")),$("#card_number option:last-child").text(a[t].cards[e]);$(".wallet_item").on("click",function(){for(var t in $(".wallet_item").removeClass("active"),$(this).addClass("active"),$("#card_oper").remove(),$("#card_table_id").remove(),$("#card_adj").css("display","none"),a)if($(this).text()==a[t].id)for(var e in $("#card_item").empty(),a[t].cards)$("<div class='card-item'></div>").prependTo($("#card_item")),$("#card_item .card-item:first-child").html("<div class='card'><p class='card_num'>"+a[t].cards[e]+"</p></div><a href='card_pay.html' class='pay'><img src='img/card.png'><p>Перевести</p></a><div class='pay trans'><img src='img/transaction.png'><p>Виписка операцій</p></div><div class='pay adj'><img src='img/terminal.png'><p>Поповнити</p></div>");$("#card_item .card-item .card").on("click",function(){$(".card-item").removeClass("active"),$(this).parent().addClass("active"),$("#card_oper").remove(),$("#card_table_id").remove(),$("#card_adj").css("display","none")}),$(".pay.trans").on("click",function(){cards_transactions()}),$(".pay.adj").on("click",function(){$("#card_oper").remove(),$("#card_table_id").remove(),$("#card_adj").css("display","block"),$("#card_adj_num").val($(".card-item.active .card_num").text())})})}})}function card_adjunction(){var t=new FormData(document.forms.card_adj),e=new XMLHttpRequest;e.open("POST","/card/adjunction",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?location.reload():window.location.href="error.html",!0},e.send(t)}function card_pay(){var t=new FormData(document.forms.card_pay),e=new XMLHttpRequest;e.open("POST","/transfer",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="confirm_transaction.html":window.location.href="error.html",!0},e.send(t)}function cards_transactions(){$("#card_adj").css("display","none");var t="/accounts/cards/"+$(".card-item.active .card_num").text();$.ajax({type:"GET",url:t,dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(t){for(var e in $("#card_oper").remove(),$("#card_table_id").remove(),$("<table id='card_oper'></table>").appendTo("#cards_trans"),t){var a,r,n=t[e].date,c=t[e].amount,o=t[e].description,i=t[e].status,d=t[e].currency,s=$(".card-item.active .card_num").text();a="OK"===i?"img/confirm.png":"UNCONFIRMED"===i?"img/process.png":"img/cancel.png",r=(s===t[e].to?t[e].from:t[e].to)==Number(s)?"img/arrow_up.png":"img/arrow_down.png",$("<tr></tr>").appendTo("#card_oper"),$("#card_oper tr:last-child").html("<td>"+n+"</td><td>"+o+"</td><td><img src='"+r+"'>"+c+" "+d+"</td><td><img src='"+a+"'></td>")}$("#card_table_id").length<=0&&($("<h4 id='card_table_id'></h4>").prependTo("#cards_trans"),$("h4").text("Операції по картці "+s))},statusCode:{405:function(){return window.location.href="error.html",!0}}})}function credit_add_card(){var t=new FormData(document.forms.credit_card_create),e=new XMLHttpRequest;e.open("POST","/credits/add_card",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?window.location.href="card_info.html":window.location.href="error.html",!0},e.send(t)}function registration(){var t=new FormData(document.forms.regist),e=new XMLHttpRequest;e.open("POST","/regist",!0),e.onreadystatechange=function(){if(4==e.readyState){if(201==e.status)return location.reload(),!0;if(405!=e.status)return window.location.href="error.html",!0;alert("Користувач з такими даними вже зареєстрований")}},e.send(t)}function error(){$.ajax({type:"GET",url:"/errormsg",dataType:"json",success:function(t){$("#error_message").text(t.msg)}})}function rates(){$.ajax({type:"GET",url:"/rates",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(t){for(var e in t)$("<option></option>").appendTo("#acc_new_currency"),$("#acc_new_currency option:last-child").text(t[e]),$("<option></option>").appendTo("#credit_new_currency"),$("#credit_new_currency option:last-child").text(t[e]);for(var a in t)$("<p></p>").appendTo("marquee"),$("marquee p:last-child").html(t[a].name+"<span>"+t[a].rateBuy.toFixed(2)+"</span><span>"+t[a].rateSale.toFixed(2)+"</span>")}})}function new_card_info(){$.ajax({type:"GET",url:"/card/info",dataType:"json",error:function(){alert("Сталася помилка, сторінку буде перезавантажено."),location.reload()},success:function(t){$("#new_card_num").text("Номер картки: "+t.id),$("#new_card_validity").text("Турмін дії: "+t.mounth+"/"+t.year),$("#new_card_cvv").text("Код CVV: "+t.cvv)}})}function user_message(){var t=new FormData(document.forms.user_message),e=new XMLHttpRequest;e.open("POST","/communications",!0),e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status?location.reload():alert("Сталася помилка, повторіть спробу ще раз."),!0},e.send(t)}$(".acc_menu li").on("click",function(t){for(var e=0;e<$(".acc_menu li").length;e++)if(t.currentTarget===$(".acc_menu li")[e]){$(".acc_menu li").css("color","#ffffff"),$(this).css("color","#c11039");var a=$(".acc_item")[e];t.currentTarget!==$(".acc_menu li")[2]?($(".acc_item").css("display","none"),$(a).css("display","block")):($(".acc_item").css("display","none"),$(a).css("display","flex"))}}),$(".button div").on("click",function(){$(".button div").removeClass("active"),$(this).addClass("active"),$("#log").hasClass("active")?($(".log").css("display","block"),$(".reg").css("display","none")):$("#reg").hasClass("active")&&($(".reg").css("display","block"),$(".log").css("display","none"))}),$("#card_pay .card-item").on("click",function(){$(".card-item").removeClass("active"),$(this).addClass("active")}),$("#user_message").on("submit",function(t){t.preventDefault(),user_message()}),$("#user_update").on("submit",function(t){t.preventDefault();0<$("#phone_new").val().length?/^\d{12}$/.test($("#phone_new").val())?userUpdate():alert("Форма містить некорректні дані"):0<$("#email_new").val().length?/\w{2,}\@\w{2,}\.\w{1,4}/.test($("#email_new").val())?userUpdate():alert("Форма містить некорректні дані"):userUpdate()}),$("#credit_offer").on("submit",function(t){t.preventDefault(),credit_offer()}),$("#login").on("submit",function(t){t.preventDefault(),user()}),$("#credit_item").on("submit",function(t){t.preventDefault(),credit_create()}),$("#transfer").on("submit",function(t){t.preventDefault();var e=$("#to_account").val(),a=$("#egrpou").val(),r=$("#mfo").val(),n=$("#transfer_sum").val();/\d{14,16}/.test(e)&&/\d{6}/.test(r)&&/\d{8,10}/.test(a)&&/\d{2,}/.test(n)?(t.preventDefault(),transferCreate()):(t.preventDefault(),alert("Форма містить некорректні дані"))}),$("#confirm_transfer").on("submit",function(t){t.preventDefault(),transferConfirm()}),$("#confirm_create").on("submit",function(t){t.preventDefault(),creationConfirm()}),$("#card_pay").on("submit",function(t){t.preventDefault();/^\d{3}$/.test($("#cvc_number").val())&&$("#card_number").val()!==$("#to_card_number").val()?card_pay():alert("Форма містить некоректні дані")}),$("#card_adj").on("submit",function(t){t.preventDefault(),card_adjunction()}),$(".account_create").on("click",function(){$(".wallet-empty").css("display","block")}),$("#account_create").on("submit",function(t){t.preventDefault(),account_create()}),$("#credit_card_create").on("submit",function(t){t.preventDefault(),credit_add_card()}),$("#regist").on("submit",function(t){t.preventDefault();var e=/^\W{2,}$/;e.test($("#name").val())&&e.test($("#surname").val())&&/^\d{12}$/.test($("#phone_num").val())&&/\w{2,}\W\w{2,}\.\w{1,4}/.test($("#email").val())&&/^\d{10}$/.test($("#ipn").val())?registration():alert("Форма містить некорректні дані")}),$(".acc_adjunction").on("click",function(){$("#account_adj").css("display","block"),$("#oper").css("display","none"),$("#acc_adj_num").val($(".account_trans").attr("id"))}),$(".cred_adjunction").on("click",function(){$("#credit_adj").css("display","block"),$("#credit_oper").css("display","none"),$("#cred_adj_num").val($(".credit_trans").attr("id"))}),$("#acc_adj").on("submit",function(t){t.preventDefault(),account_adjunction()}),$("#cred_adj").on("submit",function(t){t.preventDefault(),credit_adjunction()}),$(".money").on("change",function(){$(this).val()<0?($(this).css("border","2px solid red"),alert("Введіть коректне значення суми"),$("[type = submit]").prop("disabled",!0)):($(this).css("border","2px solid green"),$("[type = submit]").prop("disabled",!1))}),$("#wallet_info").on("click",function(){$("#wallet_id").empty(),$("#account").empty(),accounts()}),$("#trans_btn").on("click",function(){$("#account").empty(),accounts(),credits()}),$("#credit_btn").on("click",function(){$("#credit_id").empty(),$("#account").empty(),credits()}),$("#cards_btn").on("click",function(){$("#wallet_card_num").empty(),cards()}),$(".message").on("click",function(){$("#user_message").css("display","block")}),$(".log_btn").on("click",function(){sessionStorage.setItem("surl","#profile")}),$("#cred").on("click",function(){sessionStorage.setItem("surl","#credit")}),$("#wall").on("click",function(){sessionStorage.setItem("surl","#wallet")});