var cityName,json;function currentWeather(){var e="https://api.openweathermap.org/data/2.5/weather?q="+cityName+"&units=metric&appid=327f72fab114ed047d69b86da9f3afc9";$.ajax({type:"GET",url:e,dataType:"json",cash:!0,success:function(e){$("#city").val("");var a=new Date,n=a.getDate(),r=a.getMonth()+1;n<10&&(n="0"+n),r<10&&(r="0"+r),a=n+"."+r+"."+a.getFullYear(),$("#date").empty(),$("#date").text(a);var i,t=Math.round(e.main.temp),s=parseInt(e.main.pressure),c=e.main.humidity,o=e.wind;switch(e.weather[0].icon){case"11d":case"11n":$(".main").css("backgroundImage","url(img/thunderstorm.png)");break;case"09d":case"09n":$(".main").css("backgroundImage","url(img/shower-rain.png)");break;case"10d":case"10n":$(".main").css("backgroundImage","url(img/rain.png)");break;case"13d":case"13n":$(".main").css("backgroundImage","url(img/snow.png)");break;case"50d":case"05n":$(".main").css("backgroundImage","url(img/mist.png)");break;case"01d":case"01n":$(".main").css("backgroundImage","url(img/clear-sky.png)");break;case"02d":case"02n":$(".main").css("backgroundImage","url(img/few-clouds.png)");break;case"03d":case"03n":$(".main").css("backgroundImage","url(img/scattered-clouds.png)");break;case"04d":case"04n":$(".main").css("backgroundImage","url(img/broken-clouds.png)")}337.5<=o.deg||o.deg<=22.5?i="N":22.5<=o.deg&&o.deg<=67.4?i="NE":67.5<=o.deg&&o.deg<=112.4?i="E":112.5<=o.deg&&o.deg<=157.4?i="SE":157.5<=o.deg&&o.deg<=202.4?i="S":247.5<=o.deg&&o.deg<=247.4?i="SW":202.5<=o.deg&&o.deg<=292.4?i="W":292.5<=o.deg&&o.deg<=337.4&&(i="NW"),$("#location").text(e.name+", "+e.sys.country),$("#temp").empty(),void 0!==e.main.temp&&(0<t?$("#temp").html("+"+t+" <sup>o</sup>C"):$("#temp").html(t+" <sup>o</sup>C")),$("#humidity").empty(),void 0!==c&&$("#humidity").text(c+" %"),$("#pressure").empty(),void 0!==s&&$("#pressure").text(s+" kPa"),$("#wind").empty(),void 0!==i?void 0!==o.speed?$("#wind").text(i+", "+Math.round(o.speed)+" m/s"):$("#wind").text(i):$("#wind").text(Math.round(o.speed)+" m/s")}}),$("#back").css("visibility","hidden")}function forecast(){var e="https://api.openweathermap.org/data/2.5/forecast?q="+cityName+"&units=metric&appid=327f72fab114ed047d69b86da9f3afc9";$.ajax({type:"GET",url:e,dataType:"json",success:function(e){for(var a=e.list,i=[],n=0;n<4;n++){for(var r={},t=$(".mini-plate")[n],s=0;s<a.length;s++){var c=new Date,o=c.getDate()+n+1,g=c.getMonth()+1,m=c.getFullYear();o<10&&(o="0"+o),g<10&&(g="0"+g),c=m+"-"+g+"-"+o,r.day=o+"."+g+"."+m;var d=[],u=[],p=[],l=[],h=[];for(s=0;s<a.length;s++){var b;if(a[s].dt_txt.match(c))d.push(a[s].main.temp),u.push(a[s].main.humidity),p.push(a[s].main.pressure),l.push(a[s].wind.speed),void 0!==a[s].rain?b="img/shower-rain-icon.png":void 0!==a[s].snow&&(b="img/snow-icon.png"),h.push(a[s].clouds.all)}l.sort(),l.reverse();for(var k=Math.round(l[0]),f=0,y=0;y<u.length;y++)f+=u[y];for(var v=Math.round(f/y),w=0,I=0;I<p.length;I++)w+=p[I];var x,M,C=Math.round(w/I);d.sort(),x=0<d[0]?"+"+Math.round(d[0])+" <sup>o</sup>C":Math.round(d[0])+" <sup>o</sup>C",d.reverse(),M=0<d[0]?"+"+Math.round(d[0])+" <sup>o</sup>C":Math.round(d[0])+" <sup>o</sup>C";for(var N=0,E=0;E<h.length;E++)N+=h[E];var T=Math.round(N/E);void 0===b&&(b=T<10?"img/clear-icon.png":h<30?"img/few-clouds-icon.png":h<50?"img/scattered-clouds-icon.png":"img/broken-clouds-icon.png"),r.icon=b}r.speed=k,r.humidity=v,r.pressure=C,r.minTemperature=x,r.temperature=M,i.push(r),$(t).html("<img src='"+b+"'><h3>"+o+"."+g+"</h3><h4>"+M+"</h4>"),$(".mini-plate").on("click",function(e){$("#back").css("visibility","visible");for(var a=e.currentTarget,n=0;n<i.length;n++){var r;switch(a==$(".mini-plate")[0]?r=i[0]:a==$(".mini-plate")[1]?r=i[1]:a==$(".mini-plate")[2]?r=i[2]:a==$(".mini-plate")[3]&&(r=i[3]),$("#date").text(r.day),$("#temp").html(r.minTemperature+"<br>"+r.temperature),$("#humidity").text(r.humidity+" %"),$("#wind").text(r.speed+" m/s"),$("#pressure").text(r.pressure+" kPa"),r.icon){case"img/thunderstorm-icon.png":$(".main").css("backgroundImage","url(img/thunderstorm.png)");break;case"img/shower-rain-icon.png":$(".main").css("backgroundImage","url(img/shower-rain.png)");break;case"img/rain-icon.png":$(".main").css("backgroundImage","url(img/rain.png)");break;case"img/snow-icon.png":$(".main").css("backgroundImage","url(img/snow.png)");break;case"img/img/mist-icon.png":$(".main").css("backgroundImage","url(img/mist.png)");break;case"img/clear-icon.png":$(".main").css("backgroundImage","url(img/clear-sky.png)");break;case"img/few-clouds-icon.png":$(".main").css("backgroundImage","url(img/few-clouds.png)");break;case"img/scattered-clouds-icon.png":$(".main").css("backgroundImage","url(img/scattered-clouds.png)");break;case"img/broken-clouds-icon.png":$(".main").css("backgroundImage","url(img/broken-clouds.png)")}}})}}})}cityName=null==localStorage.city?"Kyiv":localStorage.city,$("#city").on("change",function(){$("#city").val().length<2?$("#city").css({border:"2px solid #B40404",backgroundColor:"#F6CECE"}):(cityName=$("#city").val(),$("#city").css({border:"none",backgroundColor:"#ffffff"}),localStorage.setItem("city",$("#city").val()))}),$("#search").on("submit",function(e){e.preventDefault(),currentWeather(),forecast()}),$(window).on("load",function(){currentWeather(),forecast()}),$("#logo, #back").on("click",function(){currentWeather(),forecast()});